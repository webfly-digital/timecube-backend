function JCTitleSearch(a){var b=this;this.arParams={AJAX_PAGE:a.AJAX_PAGE,CONTAINER_ID:a.CONTAINER_ID,INPUT_ID:a.INPUT_ID,MIN_QUERY_LEN:parseInt(a.MIN_QUERY_LEN)},a.WAIT_IMAGE&&(this.arParams.WAIT_IMAGE=a.WAIT_IMAGE),a.MIN_QUERY_LEN<=0&&(a.MIN_QUERY_LEN=1),this.cache=[],this.cache_key=null,this.startText="",this.running=!1,this.currentRow=-1,this.RESULT=null,this.CONTAINER=null,this.INPUT=null,this.WAIT=null,this.ShowResult=function(a){BX.type.isString(a)&&(b.RESULT.innerHTML=a),b.RESULT.style.display=""!==b.RESULT.innerHTML?"block":"none";var d,e,c=b.adjustResultNode(),f=BX.findChild(b.RESULT,{tag:"table",class:"title-search-result"},!0);if(f&&(e=BX.findChild(f,{tag:"th"},!0)),e){var g=BX.pos(f);g.width=g.right-g.left;var h=BX.pos(e);h.width=h.right-h.left,e.style.width=h.width+"px",b.RESULT.style.width=c.width+h.width+"px",b.RESULT.style.left=c.left-h.width-1+"px",g.width-h.width>c.width&&(b.RESULT.style.width=c.width+h.width-1+"px"),g=BX.pos(f),d=BX.pos(b.RESULT),d.right>g.right&&(b.RESULT.style.width=g.right-g.left+"px")}var i;f&&(i=BX.findChild(b.RESULT,{class:"title-search-fader"},!0)),i&&e&&(d=BX.pos(b.RESULT),i.style.left=d.right-d.left-18+"px",i.style.width="18px",i.style.top="0px",i.style.height=d.bottom-d.top+"px",i.style.display="block")},this.onKeyPress=function(a){var c=BX.findChild(b.RESULT,{tag:"div",class:"bxr-title-search-result"},!0);if(!c)return!1;var d,e=$(c).find(">div.bx_item_block_el"),f=e.length;switch(a){case 27:return b.RESULT.style.display="none",b.currentRow=-1,b.UnSelectAll(),!0;case 40:"none"==b.RESULT.style.display&&(b.RESULT.style.display="block");var g=-1;for(d=0;d<f;d++){if(g==-1&&(g=d),b.currentRow<d){b.currentRow=d;break}$($(e)[d]).is(".title-search-selected")&&$($(e)[d]).removeClass("title-search-selected")}return d==f&&b.currentRow!=d&&(b.currentRow=g),$($(e)[b.currentRow]).addClass("title-search-selected"),!0;case 38:"none"==b.RESULT.style.display&&(b.RESULT.style.display="block");var h=-1;for(d=f-1;d>=0;d--){if(h==-1&&(h=d),b.currentRow>d){b.currentRow=d;break}$($(e)[d]).is(".title-search-selected")&&$($(e)[d]).removeClass("title-search-selected")}return d<0&&b.currentRow!=d&&(b.currentRow=h),$($(e)[b.currentRow]).addClass("title-search-selected"),!0;case 13:if("block"==b.RESULT.style.display)for(d=0;d<f;d++)if(b.currentRow==d){var i=BX.findChild($(e)[d],{tag:"a"},!0);if(i)return window.location=i.href,!0}return!1}return!1},this.onTimeout=function(){b.onChange(function(){setTimeout(b.onTimeout,500)})},this.onChange=function(a){if(!b.running){if(b.running=!0,b.INPUT.value!=b.oldValue&&b.INPUT.value!=b.startText)if(b.oldValue=b.INPUT.value,b.INPUT.value.length>=b.arParams.MIN_QUERY_LEN){if(b.cache_key=b.arParams.INPUT_ID+"|"+b.INPUT.value,null==b.cache[b.cache_key]){if(b.WAIT){var c=BX.pos(b.INPUT),d=c.bottom-c.top-2;b.WAIT.style.top=c.top+1+"px",b.WAIT.style.height=d+"px",b.WAIT.style.width=d+"px",b.WAIT.style.left=c.right-d+2+"px",b.WAIT.style.display="block"}return void BX.ajax.post(b.arParams.AJAX_PAGE,{ajax_call:"y",INPUT_ID:b.arParams.INPUT_ID,q:b.INPUT.value,l:b.arParams.MIN_QUERY_LEN},function(c){b.cache[b.cache_key]=c,b.ShowResult(c),b.currentRow=-1,b.EnableMouseEvents(),b.WAIT&&(b.WAIT.style.display="none"),a&&a(),b.running=!1})}b.ShowResult(b.cache[b.cache_key]),b.currentRow=-1,b.EnableMouseEvents()}else b.RESULT.style.display="none",b.currentRow=-1,b.UnSelectAll();a&&a(),b.running=!1}},this.UnSelectAll=function(){var a=BX.findChild(b.RESULT,{tag:"table",class:"title-search-result"},!0);if(a)for(var c=a.rows.length,d=0;d<c;d++)a.rows[d].className=""},this.EnableMouseEvents=function(){var a=BX.findChild(b.RESULT,{tag:"table",class:"title-search-result"},!0);if(a)for(var c=a.rows.length,d=0;d<c;d++)BX.findChild(a.rows[d],{class:"title-search-separator"},!0)||(a.rows[d].id="row_"+d,a.rows[d].onmouseover=function(a){b.currentRow!=this.id.substr(4)&&(b.UnSelectAll(),this.className="title-search-selected",b.currentRow=this.id.substr(4))},a.rows[d].onmouseout=function(a){this.className="",b.currentRow=-1})},this.onFocusLost=function(a){setTimeout(function(){b.RESULT.style.display="none"},250)},this.onFocusGain=function(){b.RESULT.innerHTML.length&&b.ShowResult()},this.onKeyDown=function(a){if(a||(a=window.event),"block"==b.RESULT.style.display&&b.onKeyPress(a.keyCode))return BX.PreventDefault(a)},this.adjustResultNode=function(){var a,c=BX.findParent(b.CONTAINER,BX.is_fixed);return c?(b.RESULT.style.position="absolute",b.RESULT.style.zIndex=BX.style(c,"z-index")+2,a=BX.pos(b.CONTAINER,!0)):(b.RESULT.style.position="absolute",a=BX.pos(b.CONTAINER)),a=BX.pos(b.CONTAINER,!0),a.width=a.right-a.left,b.RESULT.style.top=a.bottom+2+"px",b.RESULT.style.left=a.left+"px",b.RESULT.style.width=a.width+"px",a},this._onContainerLayoutChange=function(){"none"!==b.RESULT.style.display&&""!==b.RESULT.innerHTML&&b.adjustResultNode()},this.Init=function(){this.CONTAINER=document.getElementById(this.arParams.CONTAINER_ID),BX.addCustomEvent(this.CONTAINER,"OnNodeLayoutChange",this._onContainerLayoutChange),this.RESULT=this.CONTAINER.appendChild(document.createElement("DIV")),this.RESULT.className="title-search-result",this.INPUT=document.getElementById(this.arParams.INPUT_ID),this.startText=this.oldValue=this.INPUT.value,BX.bind(this.INPUT,"focus",function(){b.onFocusGain()}),BX.bind(this.INPUT,"blur",function(){b.onFocusLost()}),BX.browser.IsSafari()||BX.browser.IsIE()?this.INPUT.onkeydown=this.onKeyDown:this.INPUT.onkeypress=this.onKeyDown,this.arParams.WAIT_IMAGE&&(this.WAIT=document.body.appendChild(document.createElement("DIV")),this.WAIT.style.backgroundImage="url('"+this.arParams.WAIT_IMAGE+"')",BX.browser.IsIE()||(this.WAIT.style.backgroundRepeat="none"),this.WAIT.style.display="none",this.WAIT.style.position="absolute",this.WAIT.style.zIndex="1100"),BX.bind(this.INPUT,"bxchange",function(){b.onChange()})},BX.ready(function(){b.Init(a)})}
//# sourceMappingURL=script.map.js