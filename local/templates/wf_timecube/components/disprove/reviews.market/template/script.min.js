!function(){"use strict";window.JSDisproveReviewsComponent||(window.JSDisproveReviewsComponent=function(e){this.formPosting=!1,this.siteId=e.siteId||"",this.ajaxId=e.ajaxId||"",this.template=e.template||"",this.componentPath=e.componentPath||"",this.parameters=e.parameters||"",this.lazyLoad=e.lazyLoad||"",this.loadOnScroll=e.loadOnScroll||"",this.sendText=e.sendText||"",this.filterStar=0,e.navParams&&(this.navParams={NavNum:e.navParams.NavNum||1,NavPageNomer:parseInt(e.navParams.NavPageNomer)||1,NavPageCount:parseInt(e.navParams.NavPageCount)||1}),this.lazyLoad&&window.addEventListener("scroll",(()=>JSDisproveReviewsComponent.prototype.loadOnScroll.call(this)),{passive:!0}),JSDisproveReviewsComponent.prototype.activeLinksTab.call(),JSDisproveReviewsComponent.prototype.activeVote.call(this),JSDisproveReviewsComponent.prototype.activeForm.call(this),this.container=document.querySelector('[data-entity="'+e.container+'"]'),this.lazyLoadContainer=document.querySelector('[data-entity="lazy-'+e.container+'"]'),this.showMoreButton=document.querySelector('[data-use="show-more-'+this.navParams.NavPageNomer+'"]'),JSDisproveReviewsComponent.prototype.lazyLoadBtn.call(this),JSDisproveReviewsComponent.prototype.selectedDrop.call(this)},window.JSDisproveReviewsComponent.prototype={sendRequest:function(e,t="N"){var o={siteId:this.siteId,template:this.template,parameters:this.parameters};this.ajaxId&&(o.AJAX_ID=this.ajaxId);var a=Object.assign(o,e),n=new FormData,i=this;for(var s in a)n.append(s,a[s]);i.filterStar&&n.append("STAR",this.filterStar);var r="/bitrix/components/disprove/reviews.market/ajax.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),c=new XMLHttpRequest;this.showMoreButton;c.open("POST",r),c.onreadystatechange=function(e){if(4==c.readyState&&200==c.status){c.responseText;var o=document.implementation.createHTMLDocument().documentElement;o.innerHTML=c.responseText;var n={items:o.querySelectorAll(".dr-item"),pagination:o.querySelector(".pagination_block")};"N"!==t&&[].forEach.call(document.querySelectorAll(".dr-item"),(function(e){e.remove()})),a.STAR&&window.history.replaceState("","","?STAR="+a.STAR),i.processShowMoreAction(n),i.activeLinksTab(),i.activeVote(),i.activeForm()}},c.send(n)},processShowMoreAction:function(e){this.formPosting=!1,e&&(this.processItems(e.items),this.processPagination(e.pagination),this.checkButton())},processItems:function(e,t){var o;if(e&&e.length)for(o in e)e.hasOwnProperty(o)&&this.container.querySelector(".dreview_list_new").appendChild(e[o])},processPagination:function(e){var t=document.querySelector('[data-pagination-num="'+this.navParams.NavPageNomer+'"]'),o=document.querySelector(".more-load");o.style.display="none",this.navParams.NavPageNomer++,this.navParams.NavPageCount=Number(e.dataset.paginationPages),t&&t.remove(),e&&(document.querySelector(".dreview_block").appendChild(e),o.style.display="table")},checkButton:function(){if(this.showMoreButton){if(this.navParams.NavPageNomer==this.navParams.NavPageCount)this.showMoreButton.remove(),document.querySelector('[data-pagination-num="'+this.navParams.NavPageNomer+'"]').remove(),document.querySelector(".more-load").style.display="none";return!0}return!1},loadOnScroll:function(){if(this.checkButton()){var e=window.pageYOffset,t=this.container.querySelector(".pagination_block").offsetTop;e+window.innerHeight>t&&this.showMore()}},showMore:function(){if(this.navParams.NavPageNomer<this.navParams.NavPageCount){var e={action:"showMore"};e["PAGEN_"+this.navParams.NavNum]=this.navParams.NavPageNomer+1,this.formPosting||(this.formPosting=!0,this.sendRequest(e))}},lazyLoadBtn:function(){if(this.loadOnScroll&&this.showMoreButton){this.showMoreButtonMessage=this.showMoreButton.innerHTML;var e=this;this.showMoreButton.onclick=function(t){JSDisproveReviewsComponent.prototype.showMore.call(e)}}},selectedDrop(){var e=document.querySelectorAll(".dr-select_drop_down div");if(e){var t=this;[].forEach.call(e,(function(e){e.onclick=function(e){if(this.classList.contains("active"))return!1;var o=this.closest(".dr-select_drop_down"),a=this.closest(".dr-select-selection"),n=a.querySelector(".dr-select-selection-input");o.classList.contains("dr-sort-date")&&(n.classList.remove("down"),n.classList.remove("up"),n.classList.add(this.getAttribute("class")));for(var i=o.querySelectorAll("div"),s=0;s<i.length;s++)i[s].classList.remove("active");this.classList.add("active"),a.classList.toggle("active"),a.querySelector(".dr-select-selection-input").innerHTML=this.innerHTML;var r=this.dataset.value;if(t.filterStar=r,r&&r>0){var c={};c.STAR=r;var l=document.querySelector('[data-pagination-num="'+t.navParams.NavPageNomer+'"]');l&&l.remove(),t.navParams.NavPageNomer=0,c["PAGEN_"+t.navParams.NavNum]=1,c.action="showMore",t.formPosting||(t.formPosting=!0,t.sendRequest(c,"Y"))}}}))}},activeVote(){var e=document.querySelectorAll(".vote-action");if(e){[].forEach.call(e,(function(e){e.onclick=function(){var e=0,t={},o=new FormData,a=this.closest(".vote-widget-container"),n=this.closest(".dr-item").dataset.id,i=a.querySelector(".vote-sum");if(t={AJAX:"Y",id:n},this.classList.contains("voted"))return!1;if(a.classList.contains("voted"))return!1;for(var s in this.classList.add("voted"),this.classList.contains("positive")?(e=Number(i.innerHTML)+1,t.type=1):(e=Number(i.innerHTML)-1,t.type=0),e>0?(i.classList.remove("negative"),i.classList.add("positive")):(i.classList.remove("positive"),i.classList.add("negative"),e*=-1),a.classList.add("voted"),i.innerHTML=e,t)o.append(s,t[s]);var r="/bitrix/components/disprove/reviews.market/like.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":""),c=new XMLHttpRequest;c.open("POST",r),c.onreadystatechange=function(e){},c.send(o)}}))}},activeForm(){var e=this,t=document.querySelectorAll(".new-opinion-cancel, .btn-show-from");t&&[].forEach.call(t,(function(e){e.onclick=function(){document.getElementById("form-send").classList.toggle("d-hidden")}}));var o=document.querySelectorAll(".sources-container .d-btn"),a=document.querySelectorAll(".sources-container input");o&&[].forEach.call(o,(function(e){e.onclick=function(){for(var e=0;e<a.length;e++)a[e].checked=!1,o[e].classList.remove("d-active");this.classList.add("d-active"),this.querySelector("input").checked=!0}}));var n=document.querySelectorAll(".marks .marks-list .star-item");n&&[].forEach.call(n,(function(t){t.onclick=function(){for(var t=e.getIndex(this),o=0;o<n.length;o++)e.getIndex(n[o])<=t?(n[o].classList.add("active"),o+1,document.getElementById("addopinionform-grade").value=o+1):n[o].classList.remove("active")}}));var i=document.querySelectorAll(".dr-select-selection-input");i&&[].forEach.call(i,(function(e){e.onclick=function(){this.closest(".dr-select-selection").classList.toggle("active")}}));var s=document.querySelector(".d-btn.new-send");s&&(s.onclick=function(t){t.preventDefault(),t.stopPropagation();var o=!1,a=document.getElementById("addopinionform-author"),n=document.getElementById("addopinionform-city"),i=document.getElementById("addopinionform-grade"),s=document.getElementById("addopinionform-pro"),r=document.getElementById("addopinionform-contra"),c=document.getElementById("addopinionform-text"),l=document.querySelector("input[name=period]:checked");if(a.classList.remove("error"),n.classList.remove("error"),0===a.value.length&&(a.classList.add("error"),o=!0),0===n.value.length&&(n.classList.add("error"),o=!0),1==o)return!1;var d=new FormData;d.append("text",c.value),d.append("contra",r.value),d.append("pro",s.value),d.append("rating",i.value),d.append("city",n.value),d.append("userName",a.value),d.append("period",l.value);var u=new XMLHttpRequest,m="/bitrix/components/disprove/reviews.market/add_review.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":"");u.open("POST",m),u.onreadystatechange=function(){if(4==u.readyState&&200==u.status){u.responseText;"SUCCESS"==JSON.parse(u.responseText).STATUS&&(document.querySelector(".dymarket_add").innerHTML="<div class='success_text'>"+e.sendText+"</div>",e.activeLinksTab(),setTimeout((function(){document.getElementById("form-send").classList.toggle("d-hidden")}),5e3))}},u.send(d)});var r=document.querySelector(".cityDrop input");r&&(r.onkeyup=function(){var t=this.value.length,o=this.closest(".cityDrop").querySelector(".DropCityBox");if(o.innerHTML="",t<3)return!1;var a=new FormData;a.append("val",this.value);var n=new XMLHttpRequest,i="/bitrix/components/disprove/reviews.market/city.php"+(-1!==document.location.href.indexOf("clear_cache=Y")?"?clear_cache=Y":"");n.open("POST",i),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var t=n.responseText;t.length>0&&(o.style.display="block",o.innerHTML="<ul>"+t+"</ul>",e.selectedCity())}},n.send(a)})},selectedCity(){var e=document.querySelectorAll(".cityDrop li");e&&[].forEach.call(e,(function(e){e.onclick=function(){var e=this.closest(".cityDrop"),t=this.innerHTML;e.querySelector(".DropCityBox").style.display="none",e.querySelector(".DropCityBox").innerHTML="",e.querySelector("input").value=t}}))},activeLinksTab(){var e=document.querySelectorAll(".dr-show_link");e&&[].forEach.call(e,(function(e){e.onclick=function(){this.classList.toggle("active"),this.nextElementSibling.classList.toggle("d-hidden");var e=this.nextElementSibling.querySelectorAll("img");JSDisproveReviewsComponent.prototype.iMageloaded.call(this,e)}}));var t=document.querySelectorAll(".dr-show_item_comments");t&&[].forEach.call(t,(function(e){e.onclick=function(){this.classList.toggle("active"),this.closest(".dr-item").querySelector(".dr-comments").classList.toggle("d-hidden")}}));var o=document.querySelectorAll(".dr-show_item_facts");o&&[].forEach.call(o,(function(e){e.onclick=function(){this.classList.toggle("active"),this.closest(".dr-item").querySelector(".dr-facts").classList.toggle("d-hidden")}}))},getIndex:function(e){for(var t=e.parentNode.querySelectorAll("."+e.classList[0]),o=0;o<t.length&&e!=t[o];o++);return o},iMageloaded:function(e){var t;[].forEach.call(e,(function(e){e.classList.contains("lazyloaded")||(t=e.getAttribute("data-src"),e.setAttribute("src",t),e.setAttribute("data-src",""),e.classList.remove("lazy"),e.classList.add("lazyloaded"))}))}})}();